import Head from "next/head";
import Menu from "../components/menu";
// import styled from "styled-components"
import { unstable_getServerSession } from "next-auth/next";
import { authOptions } from "./api/auth/[...nextauth]";

const SECTIONS = [
  {
    name: "Verduleria",
    products: [
      {
        id: 1,
        name: "1L de leche",
        description: "Marca el tren",
        bought: false,
      },
      {
        id: 2,
        name: "1L de agua",
        description: "Villa del cencio o si no hay Kesten",
        bought: false,
      },
    ],
    color: "emerald",
  },
];

const AddButton = ({ color, children }) => (
  <button
    className={`bg-${color}-500 border-none rounded-sm color-white py-1 px-2`}
  >
    {children}
  </button>
);
const ProductButton = ({ color, children }) => (
  <button
    className={`border-none bg-transparent text-white px-3 rounded-lg hover:bg-${color}-500`}
  >
    {children}
  </button>
);

const Section = ({ color, name, products }) => (
  <section
    className={`bg-${
      color ? color + "-400" : "transparent"
    } rounded-xl text-white p-2 my-2 mx-auto w-11/12`}
  >
    <h2>
      <u>{name}</u>
    </h2>
    <button className="text-w bg-transparent rounded border border-solid border-black tracking-wide p-1">
      + Agregar Producto
    </button>
    <div>
      {products.map((product) => (
        <Product key={product.id} {...product} />
      ))}
    </div>
  </section>
);

function Product(product) {
  return (
    <div className="flex justify-between items-center pr-1 pl-2">
      <p>{product.name}</p>
      <div className="flex gap-5 items-center">
        <div>
          <ProductButton color={"emerald"}>E</ProductButton>
          <ProductButton color={"emerald"}>X</ProductButton>
        </div>
        <input type="checkbox" />
      </div>
    </div>
  );
}

export default function Home() {
  return (
    <>
      <div className="inline-flex">
        <Head>
          <title>Create Next App</title>
          <meta name="description" content="Generated by create next app" />
          <link rel="icon" href="/favicon.ico" />
        </Head>
        <Menu></Menu>
        <main>
          {SECTIONS.map((section) => (
            <Section key={section.name} {...section} />
          ))}
          <AddButton color="green">+</AddButton>
        </main>
      </div>
    </>
  );
}

export const getServerSideProps = async (context) => {
  const session = await unstable_getServerSession(
    context.req,
    context.res,
    authOptions
  );

  if (!session) {
    return {
      redirect: {
        destination: "/login",
        permanent: false,
      },
    };
  }

  return {
    props: { session },
  };
};
